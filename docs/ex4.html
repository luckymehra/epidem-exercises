<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Exercise 4 | Epidemiological exercises in R</title>
  <meta name="description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Exercise 4 | Epidemiological exercises in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  <meta name="github-repo" content="luckymehra/epidem-exercises" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Exercise 4 | Epidemiological exercises in R" />
  
  <meta name="twitter:description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  

<meta name="author" content="Lucky Mehra" />


<meta name="date" content="2019-08-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html">
<link rel="next" href="ex9-4.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Epidemiological exercises in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="ex4.html"><a href="ex4.html"><i class="fa fa-check"></i><b>1</b> Exercise 4</a><ul>
<li class="chapter" data-level="1.1" data-path="ex4.html"><a href="ex4.html#load-packages"><i class="fa fa-check"></i><b>1.1</b> Load packages</a></li>
<li class="chapter" data-level="1.2" data-path="ex4.html"><a href="ex4.html#import-data"><i class="fa fa-check"></i><b>1.2</b> Import data</a></li>
<li class="chapter" data-level="1.3" data-path="ex4.html"><a href="ex4.html#first-mixed-model"><i class="fa fa-check"></i><b>1.3</b> First mixed model</a><ul>
<li class="chapter" data-level="1.3.1" data-path="ex4.html"><a href="ex4.html#fit-the-model"><i class="fa fa-check"></i><b>1.3.1</b> Fit the model</a></li>
<li class="chapter" data-level="1.3.2" data-path="ex4.html"><a href="ex4.html#diagnostic-plots"><i class="fa fa-check"></i><b>1.3.2</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ex4.html"><a href="ex4.html#second-mixed-model"><i class="fa fa-check"></i><b>1.4</b> Second mixed model</a><ul>
<li class="chapter" data-level="1.4.1" data-path="ex4.html"><a href="ex4.html#fit-the-model-1"><i class="fa fa-check"></i><b>1.4.1</b> Fit the model</a></li>
<li class="chapter" data-level="1.4.2" data-path="ex4.html"><a href="ex4.html#plot-observed-versus-predicted-model-values"><i class="fa fa-check"></i><b>1.4.2</b> Plot observed versus predicted model values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ex9-4.html"><a href="ex9-4.html"><i class="fa fa-check"></i><b>2</b> Exercise 9.4</a><ul>
<li class="chapter" data-level="2.1" data-path="ex9-4.html"><a href="ex9-4.html#load-packages-1"><i class="fa fa-check"></i><b>2.1</b> Load packages</a></li>
<li class="chapter" data-level="2.2" data-path="ex9-4.html"><a href="ex9-4.html#data"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="ex9-4.html"><a href="ex9-4.html#autocorrelation-statistics"><i class="fa fa-check"></i><b>2.3</b> Autocorrelation statistics</a></li>
<li class="chapter" data-level="2.4" data-path="ex9-4.html"><a href="ex9-4.html#first-variogram"><i class="fa fa-check"></i><b>2.4</b> First variogram</a></li>
<li class="chapter" data-level="2.5" data-path="ex9-4.html"><a href="ex9-4.html#second-variogram"><i class="fa fa-check"></i><b>2.5</b> Second variogram</a></li>
<li class="chapter" data-level="2.6" data-path="ex9-4.html"><a href="ex9-4.html#variogram-model-selection"><i class="fa fa-check"></i><b>2.6</b> Variogram model selection</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ex9-5.html"><a href="ex9-5.html"><i class="fa fa-check"></i><b>3</b> Exercise 9.5</a><ul>
<li class="chapter" data-level="3.1" data-path="ex9-5.html"><a href="ex9-5.html#load-packages-2"><i class="fa fa-check"></i><b>3.1</b> Load packages</a></li>
<li class="chapter" data-level="3.2" data-path="ex9-5.html"><a href="ex9-5.html#data-1"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="ex9-5.html"><a href="ex9-5.html#autocorrelation-statistics-1"><i class="fa fa-check"></i><b>3.3</b> Autocorrelation statistics</a></li>
<li class="chapter" data-level="3.4" data-path="ex9-5.html"><a href="ex9-5.html#first-variogram-1"><i class="fa fa-check"></i><b>3.4</b> First variogram</a></li>
<li class="chapter" data-level="3.5" data-path="ex9-5.html"><a href="ex9-5.html#second-variogram-1"><i class="fa fa-check"></i><b>3.5</b> Second variogram</a></li>
<li class="chapter" data-level="3.6" data-path="ex9-5.html"><a href="ex9-5.html#variogram-model-selection-1"><i class="fa fa-check"></i><b>3.6</b> Variogram model selection</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="yieldloss.html"><a href="yieldloss.html"><i class="fa fa-check"></i><b>4</b> Yield loss</a><ul>
<li class="chapter" data-level="4.1" data-path="yieldloss.html"><a href="yieldloss.html#load-packages-3"><i class="fa fa-check"></i><b>4.1</b> Load packages</a></li>
<li class="chapter" data-level="4.2" data-path="yieldloss.html"><a href="yieldloss.html#data-2"><i class="fa fa-check"></i><b>4.2</b> Data</a></li>
<li class="chapter" data-level="4.3" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-response-variable-ds"><i class="fa fa-check"></i><b>4.3</b> Mixed model for response variable DS</a><ul>
<li class="chapter" data-level="4.3.1" data-path="yieldloss.html"><a href="yieldloss.html#diagnostic-plots-1"><i class="fa fa-check"></i><b>4.3.1</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-response-variable-yield"><i class="fa fa-check"></i><b>4.4</b> Mixed model for response variable YIELD</a><ul>
<li class="chapter" data-level="4.4.1" data-path="yieldloss.html"><a href="yieldloss.html#diagnostic-plots-2"><i class="fa fa-check"></i><b>4.4.1</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-yield-and-ds"><i class="fa fa-check"></i><b>4.5</b> Linear regression between YIELD and DS</a><ul>
<li class="chapter" data-level="4.5.1" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-ry1-and-ds"><i class="fa fa-check"></i><b>4.5.1</b> Linear regression between RY1 and DS</a></li>
<li class="chapter" data-level="4.5.2" data-path="yieldloss.html"><a href="yieldloss.html#transform-dataset-a"><i class="fa fa-check"></i><b>4.5.2</b> Transform dataset a</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-ry2"><i class="fa fa-check"></i><b>4.6</b> Mixed model for RY2</a></li>
<li class="chapter" data-level="4.7" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-ry2-and-cds"><i class="fa fa-check"></i><b>4.7</b> Linear regression between RY2 and CDS</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="sas-code.html"><a href="sas-code.html"><i class="fa fa-check"></i><b>A</b> SAS code</a><ul>
<li class="chapter" data-level="A.1" data-path="sas-code.html"><a href="sas-code.html#exercise-4"><i class="fa fa-check"></i><b>A.1</b> Exercise 4</a></li>
<li class="chapter" data-level="A.2" data-path="sas-code.html"><a href="sas-code.html#exercise-9.4"><i class="fa fa-check"></i><b>A.2</b> Exercise 9.4</a></li>
<li class="chapter" data-level="A.3" data-path="sas-code.html"><a href="sas-code.html#exercise-9.5"><i class="fa fa-check"></i><b>A.3</b> Exercise 9.5</a></li>
<li class="chapter" data-level="A.4" data-path="sas-code.html"><a href="sas-code.html#yield-loss"><i class="fa fa-check"></i><b>A.4</b> Yield loss</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epidemiological exercises in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ex4" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Exercise 4</h1>
<div id="load-packages" class="section level2">
<h2><span class="header-section-number">1.1</span> Load packages</h2>
<p>Here is the R code to download the required packages for this exercise.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># install package manager &#39;pacman&#39;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(pacman)){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">install.packages</span>(<span class="st">&#39;pacman&#39;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">}</a></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<p>Load the packages needed for this exercise:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">pacman<span class="op">::</span><span class="kw">p_load</span>(tidyverse, </a>
<a class="sourceLine" id="cb3-2" title="2">       nlme, </a>
<a class="sourceLine" id="cb3-3" title="3">       emmeans)</a></code></pre></div>
</div>
<div id="import-data" class="section level2">
<h2><span class="header-section-number">1.2</span> Import data</h2>
<p>Our data is located in <code>ex4.csv</code> file, which can be found on <a href="https://raw.githubusercontent.com/luckymehra/epidem-exercises/master/data/ex4.csv">my github repo</a>. Import the data and create new variables using the code below.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># import data</span></a>
<a class="sourceLine" id="cb4-2" title="2">a &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/luckymehra/epidem-exercises/master/data/ex4.csv&quot;</span>,</a>
<a class="sourceLine" id="cb4-3" title="3">              <span class="dt">col_types =</span> <span class="kw">cols</span>(</a>
<a class="sourceLine" id="cb4-4" title="4">                <span class="dt">blk =</span> <span class="kw">col_factor</span>(), <span class="co"># parse blk as a factor</span></a>
<a class="sourceLine" id="cb4-5" title="5">                <span class="dt">trt =</span> <span class="kw">col_factor</span>() <span class="co"># parse trt as a factor</span></a>
<a class="sourceLine" id="cb4-6" title="6">                ))</a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># create new variables</span></a>
<a class="sourceLine" id="cb4-9" title="9">a<span class="op">$</span>y &lt;-<span class="st"> </span>a<span class="op">$</span>pctsev<span class="op">/</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb4-10" title="10">a<span class="op">$</span>ystar &lt;-<span class="st"> </span><span class="kw">log</span>(a<span class="op">$</span>y<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>a<span class="op">$</span>y))</a>
<a class="sourceLine" id="cb4-11" title="11">a<span class="op">$</span>wt &lt;-<span class="st"> </span>a<span class="op">$</span>y<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>a<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb4-12" title="12"></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co"># print the data</span></a>
<a class="sourceLine" id="cb4-14" title="14">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(a),</a>
<a class="sourceLine" id="cb4-15" title="15">             <span class="dt">caption =</span> <span class="st">&quot;The first 6 rows of dataset *a*.&quot;</span>)</a></code></pre></div>
<table>
<caption><span id="tab:data-import">Table 1.1: </span>The first 6 rows of dataset <em>a</em>.</caption>
<thead>
<tr class="header">
<th align="right">plot</th>
<th align="right">t</th>
<th align="left">blk</th>
<th align="left">trt</th>
<th align="right">pctsev</th>
<th align="right">y</th>
<th align="right">ystar</th>
<th align="right">wt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">101</td>
<td align="right">0</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="right">9</td>
<td align="right">0.09</td>
<td align="right">-2.313635</td>
<td align="right">0.0819</td>
</tr>
<tr class="even">
<td align="right">102</td>
<td align="right">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="right">6</td>
<td align="right">0.06</td>
<td align="right">-2.751535</td>
<td align="right">0.0564</td>
</tr>
<tr class="odd">
<td align="right">103</td>
<td align="right">0</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="right">2</td>
<td align="right">0.02</td>
<td align="right">-3.891820</td>
<td align="right">0.0196</td>
</tr>
<tr class="even">
<td align="right">201</td>
<td align="right">0</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="right">7</td>
<td align="right">0.07</td>
<td align="right">-2.586689</td>
<td align="right">0.0651</td>
</tr>
<tr class="odd">
<td align="right">202</td>
<td align="right">0</td>
<td align="left">2</td>
<td align="left">3</td>
<td align="right">5</td>
<td align="right">0.05</td>
<td align="right">-2.944439</td>
<td align="right">0.0475</td>
</tr>
<tr class="even">
<td align="right">203</td>
<td align="right">0</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="right">3</td>
<td align="right">0.03</td>
<td align="right">-3.476099</td>
<td align="right">0.0291</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># get a glimpse of data</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">glimpse</span>(a)</a></code></pre></div>
<pre><code>## Observations: 72
## Variables: 8
## $ plot   &lt;dbl&gt; 101, 102, 103, 201, 202, 203, 301, 302, 303, 401, 402, ...
## $ t      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 7, 7, 7, 7, 7, 7...
## $ blk    &lt;fct&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 1, 1, 1, 2, 2, 2, 3...
## $ trt    &lt;fct&gt; 2, 1, 3, 2, 3, 1, 3, 2, 1, 1, 2, 3, 2, 1, 3, 2, 3, 1, 3...
## $ pctsev &lt;dbl&gt; 9, 6, 2, 7, 5, 3, 4, 2, 6, 1, 1, 4, 4, 6, 10, 2, 5, 3, ...
## $ y      &lt;dbl&gt; 0.09, 0.06, 0.02, 0.07, 0.05, 0.03, 0.04, 0.02, 0.06, 0...
## $ ystar  &lt;dbl&gt; -2.313635, -2.751535, -3.891820, -2.586689, -2.944439, ...
## $ wt     &lt;dbl&gt; 0.0819, 0.0564, 0.0196, 0.0651, 0.0475, 0.0291, 0.0384,...</code></pre>
</div>
<div id="first-mixed-model" class="section level2">
<h2><span class="header-section-number">1.3</span> First mixed model</h2>
<div id="fit-the-model" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Fit the model</h3>
<p>Run the mixed model analysis using <strong>nlme</strong> package in R. The function used to fit the mixed model is called <code>lme()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># fit the model</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">mm_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lme</span>(ystar <span class="op">~</span><span class="st"> </span>trt<span class="op">*</span>t, <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb7-4" title="4">            <span class="dt">data =</span> a, </a>
<a class="sourceLine" id="cb7-5" title="5">            <span class="dt">random =</span> <span class="kw">list</span>(<span class="dt">blk =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">plot =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>), <span class="co"># random effects</span></a>
<a class="sourceLine" id="cb7-6" title="6">            <span class="dt">correlation =</span> <span class="kw">corAR1</span>(<span class="dt">form =</span> (<span class="dt">plot =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)), <span class="co"># specify that observations within a plot are autocorrelated. Other valid arguments are corAR1, corARMA, corCAR1, corCompSymm, corExp, corGaus, corLin, corRatio, corSpher, corSymm</span></a>
<a class="sourceLine" id="cb7-7" title="7">            <span class="dt">contrasts =</span> <span class="kw">list</span>(<span class="dt">trt =</span> <span class="st">&quot;contr.SAS&quot;</span>), <span class="co"># specify this option to get parameter estimates similar to reported by SAS</span></a>
<a class="sourceLine" id="cb7-8" title="8">            <span class="dt">weights =</span> <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span><span class="op">/</span>wt))</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co"># output the summary</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="kw">summary</span>(mm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: a 
##        AIC      BIC    logLik
##   210.5257 232.4222 -95.26285
## 
## Random effects:
##  Formula: ~1 | blk
##         (Intercept)
## StdDev:   0.1887117
## 
##  Formula: ~1 | plot %in% blk
##          (Intercept)  Residual
## StdDev: 4.604287e-05 0.2519511
## 
## Correlation Structure: AR(1)
##  Formula: ~1 | blk/plot 
##  Parameter estimate(s):
##        Phi 
## 0.06205463 
## Variance function:
##  Structure: fixed weights
##  Formula: ~I(1/wt) 
## Fixed effects: ystar ~ trt * t 
##                  Value Std.Error DF   t-value p-value
## (Intercept) -2.5689859 0.3629604 57 -7.077868  0.0000
## trt2        -0.1948084 0.5193013  6 -0.375136  0.7205
## trt1        -0.5406041 0.5136249  6 -1.052527  0.3331
## t            0.0992675 0.0142177 57  6.981964  0.0000
## trt2:t      -0.0221696 0.0202998 57 -1.092109  0.2794
## trt1:t       0.0437431 0.0212717 57  2.056398  0.0443
##  Correlation: 
##        (Intr) trt2   trt1   t      trt2:t
## trt2   -0.652                            
## trt1   -0.658  0.459                     
## t      -0.888  0.621  0.627              
## trt2:t  0.623 -0.924 -0.439 -0.700       
## trt1:t  0.592 -0.413 -0.913 -0.667  0.466
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.1518915 -0.6900213 -0.4024653  0.4132408  2.7733450 
## 
## Number of Observations: 72
## Number of Groups: 
##           blk plot %in% blk 
##             4            12</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># extract covariance parameter estimates</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">VarCorr</span>(mm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>##             Variance     StdDev      
## blk =       pdLogChol(1)             
## (Intercept) 3.561212e-02 1.887117e-01
## plot =      pdLogChol(1)             
## (Intercept) 2.119946e-09 4.604287e-05
## Residual    6.347936e-02 2.519511e-01</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># extract type3 fixed effects anova</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">anova.lme</span>(mm_<span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&#39;marginal&#39;</span>)</a></code></pre></div>
<pre><code>##             numDF denDF  F-value p-value
## (Intercept)     1    57 50.09622  &lt;.0001
## trt             2     6  0.56135  0.5977
## t               1    57 48.74782  &lt;.0001
## trt:t           2    57  4.80110  0.0118</code></pre>
</div>
<div id="diagnostic-plots" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Diagnostic plots</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># pearson residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, <span class="kw">resid</span>(., <span class="dt">type=</span><span class="st">&quot;pearson&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="01-ex4_files/figure-html/diagnostic-plots-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># standardaized residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, <span class="kw">resid</span>(., <span class="dt">scaled=</span><span class="ot">TRUE</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="01-ex4_files/figure-html/diagnostic-plots-2.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># qq plot</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">qqnorm</span>(<span class="kw">residuals</span>(mm_<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">qqline</span>(<span class="kw">residuals</span>(mm_<span class="dv">1</span>))</a></code></pre></div>
<p><img src="01-ex4_files/figure-html/diagnostic-plots-3.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">#observed vs. fitted values</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, ystar <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p><img src="01-ex4_files/figure-html/diagnostic-plots-4.png" width="672" /></p>
</div>
</div>
<div id="second-mixed-model" class="section level2">
<h2><span class="header-section-number">1.4</span> Second mixed model</h2>
<div id="fit-the-model-1" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Fit the model</h3>
<p>Run the mixed model analysis using <strong>nlme</strong> package in R. The function used to fit the mixed model is called <code>lme()</code>. Here we will specify no intercept. We will also use <strong>emmeans</strong> package to get least squared means and contrasts.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># fit the model</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co">#library(nlme)</span></a>
<a class="sourceLine" id="cb17-3" title="3">mm_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">update</span>(mm_<span class="dv">1</span>, <span class="dt">fixed =</span> ystar <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>trt<span class="op">:</span>t) <span class="co"># update fixed effects in mm_1, -1 indicates no intercept</span></a>
<a class="sourceLine" id="cb17-4" title="4"></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co"># output the summary</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="kw">summary</span>(mm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: a 
##        AIC      BIC    logLik
##   210.5257 232.4222 -95.26285
## 
## Random effects:
##  Formula: ~1 | blk
##         (Intercept)
## StdDev:   0.1887117
## 
##  Formula: ~1 | plot %in% blk
##          (Intercept)  Residual
## StdDev: 4.603147e-05 0.2519511
## 
## Correlation Structure: AR(1)
##  Formula: ~1 | blk/plot 
##  Parameter estimate(s):
##        Phi 
## 0.06205463 
## Variance function:
##  Structure: fixed weights
##  Formula: ~I(1/wt) 
## Fixed effects: ystar ~ trt + trt:t - 1 
##             Value Std.Error DF   t-value p-value
## trt2   -2.7637943 0.3944803  6 -7.006165   4e-04
## trt1   -3.1095900 0.3877657  6 -8.019250   2e-04
## trt3   -2.5689859 0.3629604  6 -7.077868   4e-04
## trt2:t  0.0770979 0.0144893 58  5.321034   0e+00
## trt1:t  0.1430106 0.0158560 58  9.019328   0e+00
## trt3:t  0.0992675 0.0142177 58  6.981964   0e+00
##  Correlation: 
##        trt2   trt1   trt3   trt2:t trt1:t
## trt1    0.057                            
## trt3    0.062  0.065                     
## trt2:t -0.901  0.001  0.001              
## trt1:t  0.001 -0.881 -0.002 -0.001       
## trt3:t  0.000 -0.002 -0.888  0.000  0.002
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.1518915 -0.6900213 -0.4024653  0.4132408  2.7733450 
## 
## Number of Observations: 72
## Number of Groups: 
##           blk plot %in% blk 
##             4            12</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># extract covariance parameter estimates</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">VarCorr</span>(mm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             Variance     StdDev      
## blk =       pdLogChol(1)             
## (Intercept) 3.561212e-02 1.887117e-01
## plot =      pdLogChol(1)             
## (Intercept) 2.118896e-09 4.603147e-05
## Residual    6.347936e-02 2.519511e-01</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># extract type3 fixed effects anova</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">anova.lme</span>(mm_<span class="dv">2</span>, <span class="dt">type =</span> <span class="st">&#39;marginal&#39;</span>)</a></code></pre></div>
<pre><code>##       numDF denDF  F-value p-value
## trt       3     6 48.57698   1e-04
## trt:t     3    58 52.74601  &lt;.0001</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># compare the slopes for different treatments</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co">#library(emmeans)</span></a>
<a class="sourceLine" id="cb23-3" title="3"></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="kw">emtrends</span>(mm_<span class="dv">2</span>, pairwise <span class="op">~</span><span class="st"> </span>trt, <span class="dt">var=</span><span class="st">&quot;t&quot;</span>, <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## $emtrends
##  trt t.trend     SE df lower.CL upper.CL
##  2    0.0771 0.0145 58   0.0481    0.106
##  1    0.1430 0.0159 58   0.1113    0.175
##  3    0.0993 0.0142 58   0.0708    0.128
## 
## d.f. method: containment 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast estimate     SE df t.ratio p.value
##  2 - 1     -0.0659 0.0215 58 -3.067  0.0033 
##  2 - 3     -0.0222 0.0203 58 -1.092  0.2793 
##  1 - 3      0.0437 0.0213 58  2.056  0.0443</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># get the treatment difference at various time points</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="kw">emmeans</span>(mm_<span class="dv">2</span>, pairwise <span class="op">~</span><span class="st"> </span>trt<span class="op">|</span>t, <span class="dt">nesting =</span> <span class="ot">NULL</span>, <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">t =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">28</span>, <span class="dv">35</span>)), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## $emmeans
## t =  0:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -2.7638 0.394  6   -3.729  -1.7985
##  1   -3.1096 0.388  6   -4.058  -2.1608
##  3   -2.5690 0.363  6   -3.457  -1.6809
## 
## t =  7:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -2.2241 0.306  6   -2.974  -1.4746
##  1   -2.1085 0.295  6   -2.830  -1.3873
##  3   -1.8741 0.278  6   -2.555  -1.1931
## 
## t = 14:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -1.6844 0.229  6   -2.246  -1.1232
##  1   -1.1074 0.219  6   -1.644  -0.5712
##  3   -1.1792 0.207  6   -1.687  -0.6719
## 
## t = 21:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -1.1447 0.179  6   -1.582  -0.7072
##  1   -0.1064 0.184  6   -0.556   0.3437
##  3   -0.4844 0.168  6   -0.896  -0.0726
## 
## t = 28:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -0.6051 0.179  6   -1.042  -0.1680
##  1    0.8947 0.210  6    0.380   1.4095
##  3    0.2105 0.183  6   -0.237   0.6581
## 
## t = 35:
##  trt  emmean    SE df lower.CL upper.CL
##  2   -0.0654 0.229  6   -0.626   0.4948
##  1    1.8958 0.282  6    1.207   2.5850
##  3    0.9054 0.242  6    0.314   1.4968
## 
## d.f. method: containment 
## Confidence level used: 0.95 
## 
## $contrasts
## t =  0:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1      0.3458 0.537  6  0.644  0.5435 
##  2 - 3     -0.1948 0.519  6 -0.375  0.7205 
##  1 - 3     -0.5406 0.514  6 -1.053  0.3331 
## 
## t =  7:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1     -0.1156 0.404  6 -0.286  0.7843 
##  2 - 3     -0.3500 0.392  6 -0.893  0.4062 
##  1 - 3     -0.2344 0.383  6 -0.613  0.5625 
## 
## t = 14:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1     -0.5770 0.288  6 -2.004  0.0919 
##  2 - 3     -0.5052 0.279  6 -1.811  0.1201 
##  1 - 3      0.0718 0.271  6  0.265  0.7996 
## 
## t = 21:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1     -1.0384 0.219  6 -4.739  0.0032 
##  2 - 3     -0.6604 0.206  6 -3.204  0.0185 
##  1 - 3      0.3780 0.211  6  1.794  0.1229 
## 
## t = 28:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1     -1.4998 0.242  6 -6.204  0.0008 
##  2 - 3     -0.8156 0.218  6 -3.741  0.0096 
##  1 - 3      0.6842 0.245  6  2.795  0.0314 
## 
## t = 35:
##  contrast estimate    SE df t.ratio p.value
##  2 - 1     -1.9611 0.338  6 -5.806  0.0011 
##  2 - 3     -0.9707 0.305  6 -3.184  0.0190 
##  1 - 3      0.9904 0.346  6  2.861  0.0288</code></pre>
</div>
<div id="plot-observed-versus-predicted-model-values" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Plot observed versus predicted model values</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># add fitted and residuals in to a new dataset called b</span></a>
<a class="sourceLine" id="cb27-2" title="2">b =<span class="st"> </span><span class="kw">cbind</span>(a, <span class="dt">resid =</span> <span class="kw">resid</span>(mm_<span class="dv">2</span>), <span class="dt">fitted =</span> <span class="kw">fitted</span>(mm_<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb27-3" title="3"></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="co"># fit linear regression</span></a>
<a class="sourceLine" id="cb27-5" title="5">b.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(ystar <span class="op">~</span><span class="st"> </span>fitted, <span class="dt">data=</span>b)</a>
<a class="sourceLine" id="cb27-6" title="6"></a>
<a class="sourceLine" id="cb27-7" title="7"><span class="co"># plot using ggplot2 package</span></a>
<a class="sourceLine" id="cb27-8" title="8"><span class="kw">ggplot</span>(b, <span class="kw">aes</span>(<span class="dt">x=</span>fitted, <span class="dt">y =</span> ystar)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;lightgrey&quot;</span>)</a></code></pre></div>
<p><img src="01-ex4_files/figure-html/obs-pred-plot-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ex9-4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-ex4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_epidem_exercises.pdf", "_epidem_exercises.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
