<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Yield loss | Epidemiological exercises in R</title>
  <meta name="description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Yield loss | Epidemiological exercises in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  <meta name="github-repo" content="luckymehra/epidem-exercises" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Yield loss | Epidemiological exercises in R" />
  
  <meta name="twitter:description" content="This book contains epidemiological data analysis exercises in R. These are written for students of PLPTH 905 (Ecology and Epidemiology of Plant Pathogens) offered in even springs at Kansas State University." />
  

<meta name="author" content="Lucky Mehra" />


<meta name="date" content="2019-08-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ex9-5.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Epidemiological exercises in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="ex4.html"><a href="ex4.html"><i class="fa fa-check"></i><b>1</b> Exercise 4</a><ul>
<li class="chapter" data-level="1.1" data-path="ex4.html"><a href="ex4.html#load-packages"><i class="fa fa-check"></i><b>1.1</b> Load packages</a></li>
<li class="chapter" data-level="1.2" data-path="ex4.html"><a href="ex4.html#import-data"><i class="fa fa-check"></i><b>1.2</b> Import data</a></li>
<li class="chapter" data-level="1.3" data-path="ex4.html"><a href="ex4.html#first-mixed-model"><i class="fa fa-check"></i><b>1.3</b> First mixed model</a><ul>
<li class="chapter" data-level="1.3.1" data-path="ex4.html"><a href="ex4.html#fit-the-model"><i class="fa fa-check"></i><b>1.3.1</b> Fit the model</a></li>
<li class="chapter" data-level="1.3.2" data-path="ex4.html"><a href="ex4.html#diagnostic-plots"><i class="fa fa-check"></i><b>1.3.2</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ex4.html"><a href="ex4.html#second-mixed-model"><i class="fa fa-check"></i><b>1.4</b> Second mixed model</a><ul>
<li class="chapter" data-level="1.4.1" data-path="ex4.html"><a href="ex4.html#fit-the-model-1"><i class="fa fa-check"></i><b>1.4.1</b> Fit the model</a></li>
<li class="chapter" data-level="1.4.2" data-path="ex4.html"><a href="ex4.html#plot-observed-versus-predicted-model-values"><i class="fa fa-check"></i><b>1.4.2</b> Plot observed versus predicted model values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ex9-4.html"><a href="ex9-4.html"><i class="fa fa-check"></i><b>2</b> Exercise 9.4</a><ul>
<li class="chapter" data-level="2.1" data-path="ex9-4.html"><a href="ex9-4.html#load-packages-1"><i class="fa fa-check"></i><b>2.1</b> Load packages</a></li>
<li class="chapter" data-level="2.2" data-path="ex9-4.html"><a href="ex9-4.html#data"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="ex9-4.html"><a href="ex9-4.html#autocorrelation-statistics"><i class="fa fa-check"></i><b>2.3</b> Autocorrelation statistics</a></li>
<li class="chapter" data-level="2.4" data-path="ex9-4.html"><a href="ex9-4.html#first-variogram"><i class="fa fa-check"></i><b>2.4</b> First variogram</a></li>
<li class="chapter" data-level="2.5" data-path="ex9-4.html"><a href="ex9-4.html#second-variogram"><i class="fa fa-check"></i><b>2.5</b> Second variogram</a></li>
<li class="chapter" data-level="2.6" data-path="ex9-4.html"><a href="ex9-4.html#variogram-model-selection"><i class="fa fa-check"></i><b>2.6</b> Variogram model selection</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ex9-5.html"><a href="ex9-5.html"><i class="fa fa-check"></i><b>3</b> Exercise 9.5</a><ul>
<li class="chapter" data-level="3.1" data-path="ex9-5.html"><a href="ex9-5.html#load-packages-2"><i class="fa fa-check"></i><b>3.1</b> Load packages</a></li>
<li class="chapter" data-level="3.2" data-path="ex9-5.html"><a href="ex9-5.html#data-1"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="ex9-5.html"><a href="ex9-5.html#autocorrelation-statistics-1"><i class="fa fa-check"></i><b>3.3</b> Autocorrelation statistics</a></li>
<li class="chapter" data-level="3.4" data-path="ex9-5.html"><a href="ex9-5.html#first-variogram-1"><i class="fa fa-check"></i><b>3.4</b> First variogram</a></li>
<li class="chapter" data-level="3.5" data-path="ex9-5.html"><a href="ex9-5.html#second-variogram-1"><i class="fa fa-check"></i><b>3.5</b> Second variogram</a></li>
<li class="chapter" data-level="3.6" data-path="ex9-5.html"><a href="ex9-5.html#variogram-model-selection-1"><i class="fa fa-check"></i><b>3.6</b> Variogram model selection</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="yieldloss.html"><a href="yieldloss.html"><i class="fa fa-check"></i><b>4</b> Yield loss</a><ul>
<li class="chapter" data-level="4.1" data-path="yieldloss.html"><a href="yieldloss.html#load-packages-3"><i class="fa fa-check"></i><b>4.1</b> Load packages</a></li>
<li class="chapter" data-level="4.2" data-path="yieldloss.html"><a href="yieldloss.html#data-2"><i class="fa fa-check"></i><b>4.2</b> Data</a></li>
<li class="chapter" data-level="4.3" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-response-variable-ds"><i class="fa fa-check"></i><b>4.3</b> Mixed model for response variable DS</a><ul>
<li class="chapter" data-level="4.3.1" data-path="yieldloss.html"><a href="yieldloss.html#diagnostic-plots-1"><i class="fa fa-check"></i><b>4.3.1</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-response-variable-yield"><i class="fa fa-check"></i><b>4.4</b> Mixed model for response variable YIELD</a><ul>
<li class="chapter" data-level="4.4.1" data-path="yieldloss.html"><a href="yieldloss.html#diagnostic-plots-2"><i class="fa fa-check"></i><b>4.4.1</b> Diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-yield-and-ds"><i class="fa fa-check"></i><b>4.5</b> Linear regression between YIELD and DS</a><ul>
<li class="chapter" data-level="4.5.1" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-ry1-and-ds"><i class="fa fa-check"></i><b>4.5.1</b> Linear regression between RY1 and DS</a></li>
<li class="chapter" data-level="4.5.2" data-path="yieldloss.html"><a href="yieldloss.html#transform-dataset-a"><i class="fa fa-check"></i><b>4.5.2</b> Transform dataset a</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="yieldloss.html"><a href="yieldloss.html#mixed-model-for-ry2"><i class="fa fa-check"></i><b>4.6</b> Mixed model for RY2</a></li>
<li class="chapter" data-level="4.7" data-path="yieldloss.html"><a href="yieldloss.html#linear-regression-between-ry2-and-cds"><i class="fa fa-check"></i><b>4.7</b> Linear regression between RY2 and CDS</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epidemiological exercises in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="yieldloss" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Yield loss</h1>
<div id="load-packages-3" class="section level2">
<h2><span class="header-section-number">4.1</span> Load packages</h2>
<p>Here is the R code to download the required packages for this exercise.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="co"># install package manager &#39;pacman&#39;</span></a>
<a class="sourceLine" id="cb88-2" title="2"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(pacman)){</a>
<a class="sourceLine" id="cb88-3" title="3">  <span class="kw">install.packages</span>(<span class="st">&#39;pacman&#39;</span>)</a>
<a class="sourceLine" id="cb88-4" title="4">}</a></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="co"># load packages needed for this exercise</span></a>
<a class="sourceLine" id="cb90-2" title="2">pacman<span class="op">::</span><span class="kw">p_load</span>(tidyverse,</a>
<a class="sourceLine" id="cb90-3" title="3">       nlme,</a>
<a class="sourceLine" id="cb90-4" title="4">       emmeans,</a>
<a class="sourceLine" id="cb90-5" title="5">       predictmeans</a>
<a class="sourceLine" id="cb90-6" title="6">       )</a></code></pre></div>
</div>
<div id="data-2" class="section level2">
<h2><span class="header-section-number">4.2</span> Data</h2>
<p>This is equivalent to the data step in SAS. Here, the data is imported from a file <code>yield_loss.csv</code> using the function <code>read_csv</code>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1"><span class="co"># Import data</span></a>
<a class="sourceLine" id="cb91-2" title="2">a &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/yield_loss.csv&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   WP = col_double(),
##   SP = col_character(),
##   BLK = col_double(),
##   TRT = col_double(),
##   FUNG = col_double(),
##   DS = col_double(),
##   YIELD = col_double()
## )</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1"><span class="co"># print the data</span></a>
<a class="sourceLine" id="cb93-2" title="2">a</a></code></pre></div>
<pre><code>## # A tibble: 24 x 7
##       WP SP      BLK   TRT  FUNG    DS YIELD
##    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1   101 A         1     1     0    43   205
##  2   101 B         1     1     1     1   399
##  3   102 A         1     2     1     2   426
##  4   102 B         1     2     0    92   102
##  5   103 A         1     3     1     2   385
##  6   103 B         1     3     0     7   355
##  7   201 A         2     2     1     4   412
##  8   201 B         2     2     0    75   224
##  9   202 A         2     3     1     3   425
## 10   202 B         2     3     0    10   352
## # ... with 14 more rows</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1"><span class="co"># specify that FUNG, TRT, and BLK are factors</span></a>
<a class="sourceLine" id="cb95-2" title="2">a<span class="op">$</span>FUNG &lt;-<span class="st"> </span><span class="kw">as.ordered</span>(<span class="kw">as.factor</span>(a<span class="op">$</span>FUNG))</a>
<a class="sourceLine" id="cb95-3" title="3">a<span class="op">$</span>TRT &lt;-<span class="st"> </span><span class="kw">as.ordered</span>(<span class="kw">as.factor</span>(a<span class="op">$</span>TRT))</a>
<a class="sourceLine" id="cb95-4" title="4">a<span class="op">$</span>BLK &lt;-<span class="st"> </span><span class="kw">as.ordered</span>(<span class="kw">as.factor</span>(a<span class="op">$</span>BLK))</a></code></pre></div>
</div>
<div id="mixed-model-for-response-variable-ds" class="section level2">
<h2><span class="header-section-number">4.3</span> Mixed model for response variable DS</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="co"># fit the model  </span></a>
<a class="sourceLine" id="cb96-2" title="2">mm_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lme</span>(DS <span class="op">~</span><span class="st"> </span>TRT<span class="op">*</span>FUNG, <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb96-3" title="3">            <span class="dt">data =</span> a,</a>
<a class="sourceLine" id="cb96-4" title="4">            <span class="dt">random =</span> <span class="op">~</span><span class="dv">1</span><span class="op">|</span>BLK<span class="op">/</span>TRT) <span class="co"># read mm_1 as mixed model 1</span></a>
<a class="sourceLine" id="cb96-5" title="5"></a>
<a class="sourceLine" id="cb96-6" title="6"><span class="co"># summary output</span></a>
<a class="sourceLine" id="cb96-7" title="7"><span class="kw">summary</span>(mm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: a 
##        AIC      BIC    logLik
##   156.1691 164.1825 -69.08456
## 
## Random effects:
##  Formula: ~1 | BLK
##          (Intercept)
## StdDev: 0.0009561632
## 
##  Formula: ~1 | TRT %in% BLK
##         (Intercept) Residual
## StdDev: 0.001007113 7.918859
## 
## Fixed effects: DS ~ TRT * FUNG 
##                   Value Std.Error DF    t-value p-value
## (Intercept)   20.708333  1.616430  9  12.811150  0.0000
## TRT.L         -9.457553  2.799740  6  -3.378012  0.0149
## TRT.Q        -19.646949  2.799740  6  -7.017420  0.0004
## FUNG.L       -26.457579  2.285978  9 -11.573857  0.0000
## TRT.L:FUNG.L  13.625000  3.959430  9   3.441152  0.0074
## TRT.Q:FUNG.L  26.485944  3.959430  9   6.689333  0.0001
##  Correlation: 
##              (Intr) TRT.L TRT.Q FUNG.L TRT.L:
## TRT.L        0                               
## TRT.Q        0      0                        
## FUNG.L       0      0     0                  
## TRT.L:FUNG.L 0      0     0     0            
## TRT.Q:FUNG.L 0      0     0     0      0     
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -2.241484e+00 -9.471064e-02 -1.590814e-08  1.736361e-01  2.683467e+00 
## 
## Number of Observations: 24
## Number of Groups: 
##          BLK TRT %in% BLK 
##            4           12</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="co"># type 3 tests of fixed effects</span></a>
<a class="sourceLine" id="cb98-2" title="2"><span class="kw">anova</span>(mm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>##             numDF denDF   F-value p-value
## (Intercept)     1     9 164.12557  &lt;.0001
## TRT             2     6  30.32757   7e-04
## FUNG            1     9 133.95416  &lt;.0001
## TRT:FUNG        2     9  28.29435   1e-04</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="co"># visualize interaction</span></a>
<a class="sourceLine" id="cb100-2" title="2"><span class="kw">emmip</span>(mm_<span class="dv">1</span>, TRT <span class="op">~</span><span class="st"> </span>FUNG)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/mixed-model-DS-1.png" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1"><span class="co"># to do anova for random effects, we need to compare mm_1 with a model that only has fixed effects,</span></a>
<a class="sourceLine" id="cb101-2" title="2"><span class="co"># we can use `gls()` function in `nlme` to fit the fixed effects model</span></a>
<a class="sourceLine" id="cb101-3" title="3">fixed_model &lt;-<span class="st"> </span><span class="kw">gls</span>(DS <span class="op">~</span><span class="st"> </span>TRT <span class="op">*</span><span class="st"> </span>FUNG,</a>
<a class="sourceLine" id="cb101-4" title="4">                                     <span class="dt">data =</span> a)</a>
<a class="sourceLine" id="cb101-5" title="5"></a>
<a class="sourceLine" id="cb101-6" title="6"><span class="co"># test the random effects in the model</span></a>
<a class="sourceLine" id="cb101-7" title="7"><span class="kw">anova</span>(mm_<span class="dv">1</span>, fixed_model)</a></code></pre></div>
<pre><code>##             Model df      AIC      BIC    logLik   Test      L.Ratio
## mm_1            1  9 156.1691 164.1825 -69.08456                    
## fixed_model     2  7 152.1691 158.4017 -69.08456 1 vs 2 1.250038e-08
##             p-value
## mm_1               
## fixed_model       1</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="co"># least square means</span></a>
<a class="sourceLine" id="cb103-2" title="2"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">1</span>, <span class="st">&quot;TRT&quot;</span>))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  TRT emmean  SE df t.ratio p.value
##  1     19.4 2.8  3  6.920  0.0062 
##  2     36.8 2.8  3 13.126  0.0010 
##  3      6.0 2.8  3  2.143  0.1215 
## 
## Results are averaged over the levels of: FUNG 
## d.f. method: containment</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">1</span>, <span class="st">&quot;FUNG&quot;</span>))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  FUNG emmean   SE df t.ratio p.value
##  0      39.4 2.29  3 17.243  0.0004 
##  1       2.0 2.29  3  0.875  0.4460 
## 
## Results are averaged over the levels of: TRT 
## d.f. method: containment</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="co"># pairwise difference</span></a>
<a class="sourceLine" id="cb109-2" title="2"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">1</span>, pairwise <span class="op">~</span><span class="st"> </span>TRT), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>## $emmeans
##  TRT emmean  SE df t.ratio p.value
##  1     19.4 2.8  3  6.920  0.0062 
##  2     36.8 2.8  3 13.126  0.0010 
##  3      6.0 2.8  3  2.143  0.1215 
## 
## Results are averaged over the levels of: FUNG 
## d.f. method: containment 
## 
## $contrasts
##  contrast estimate   SE df t.ratio p.value
##  1 - 2       -17.4 3.96  6 -4.388  0.0046 
##  1 - 3        13.4 3.96  6  3.378  0.0149 
##  2 - 3        30.8 3.96  6  7.766  0.0002 
## 
## Results are averaged over the levels of: FUNG</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">1</span>, pairwise <span class="op">~</span><span class="st"> </span>FUNG))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>## $emmeans
##  FUNG emmean   SE df t.ratio p.value
##  0      39.4 2.29  3 17.243  0.0004 
##  1       2.0 2.29  3  0.875  0.4460 
## 
## Results are averaged over the levels of: TRT 
## d.f. method: containment 
## 
## $contrasts
##  contrast estimate   SE df t.ratio p.value
##  0 - 1        37.4 3.23  9 11.574  &lt;.0001 
## 
## Results are averaged over the levels of: TRT</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">1</span>, pairwise <span class="op">~</span><span class="st"> </span>TRT<span class="op">*</span>FUNG), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## $emmeans
##  TRT FUNG emmean   SE df t.ratio p.value
##  1   0     37.25 3.96  3  9.408  0.0025 
##  2   0     70.75 3.96  3 17.869  0.0004 
##  3   0     10.25 3.96  3  2.589  0.0812 
##  1   1      1.50 3.96  3  0.379  0.7300 
##  2   1      2.75 3.96  3  0.695  0.5373 
##  3   1      1.75 3.96  3  0.442  0.6884 
## 
## d.f. method: containment 
## 
## $contrasts
##  contrast  estimate  SE df t.ratio p.value
##  1,0 - 2,0   -33.50 5.6  6 -5.983  0.0010 
##  1,0 - 3,0    27.00 5.6  6  4.822  0.0029 
##  1,0 - 1,1    35.75 5.6  9  6.385  0.0001 
##  1,0 - 2,1    34.50 5.6  6  6.161  0.0008 
##  1,0 - 3,1    35.50 5.6  6  6.340  0.0007 
##  2,0 - 3,0    60.50 5.6  6 10.805  &lt;.0001 
##  2,0 - 1,1    69.25 5.6  6 12.367  &lt;.0001 
##  2,0 - 2,1    68.00 5.6  9 12.144  &lt;.0001 
##  2,0 - 3,1    69.00 5.6  6 12.323  &lt;.0001 
##  3,0 - 1,1     8.75 5.6  6  1.563  0.1692 
##  3,0 - 2,1     7.50 5.6  6  1.339  0.2289 
##  3,0 - 3,1     8.50 5.6  9  1.518  0.1633 
##  1,1 - 2,1    -1.25 5.6  6 -0.223  0.8308 
##  1,1 - 3,1    -0.25 5.6  6 -0.045  0.9658 
##  2,1 - 3,1     1.00 5.6  6  0.179  0.8641</code></pre>
<div id="diagnostic-plots-1" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Diagnostic plots</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1"><span class="co"># pearson residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb117-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, <span class="kw">resid</span>(., <span class="dt">type=</span><span class="st">&quot;pearson&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-1.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1"><span class="co"># standardaized residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb118-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, <span class="kw">resid</span>(., <span class="dt">scaled=</span><span class="ot">TRUE</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-2.png" width="672" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="co"># qq plot</span></a>
<a class="sourceLine" id="cb119-2" title="2"><span class="kw">qqnorm</span>(<span class="kw">residuals</span>(mm_<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb119-3" title="3"><span class="kw">qqline</span>(<span class="kw">residuals</span>(mm_<span class="dv">1</span>))</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-3.png" width="672" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="co">#observed vs. fitted values</span></a>
<a class="sourceLine" id="cb120-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">1</span>, DS <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-4.png" width="672" /></p>
</div>
</div>
<div id="mixed-model-for-response-variable-yield" class="section level2">
<h2><span class="header-section-number">4.4</span> Mixed model for response variable YIELD</h2>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="co"># fit the model  </span></a>
<a class="sourceLine" id="cb121-2" title="2">mm_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lme</span>(YIELD <span class="op">~</span><span class="st"> </span>TRT<span class="op">*</span>FUNG, <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb121-3" title="3">            <span class="dt">data =</span> a,</a>
<a class="sourceLine" id="cb121-4" title="4">            <span class="dt">random =</span> <span class="op">~</span><span class="dv">1</span><span class="op">|</span>BLK<span class="op">/</span>TRT) <span class="co"># read mm_2 as mixed model 2</span></a>
<a class="sourceLine" id="cb121-5" title="5"></a>
<a class="sourceLine" id="cb121-6" title="6"><span class="co"># summary output</span></a>
<a class="sourceLine" id="cb121-7" title="7"><span class="kw">summary</span>(mm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: a 
##        AIC      BIC   logLik
##   209.9214 217.9348 -95.9607
## 
## Random effects:
##  Formula: ~1 | BLK
##         (Intercept)
## StdDev:    11.99815
## 
##  Formula: ~1 | TRT %in% BLK
##         (Intercept) Residual
## StdDev: 0.001914579 33.61779
## 
## Fixed effects: YIELD ~ TRT * FUNG 
##                 Value Std.Error DF  t-value p-value
## (Intercept)  335.1667  9.114752  9 36.77189  0.0000
## TRT.L         21.3016 11.885682  6  1.79221  0.1233
## TRT.Q         54.5522 11.885682  6  4.58974  0.0037
## FUNG.L        93.9274  9.704619  9  9.67862  0.0000
## TRT.L:FUNG.L -31.8750 16.808893  9 -1.89632  0.0904
## TRT.Q:FUNG.L -75.2720 16.808893  9 -4.47811  0.0015
##  Correlation: 
##              (Intr) TRT.L TRT.Q FUNG.L TRT.L:
## TRT.L        0                               
## TRT.Q        0      0                        
## FUNG.L       0      0     0                  
## TRT.L:FUNG.L 0      0     0     0            
## TRT.Q:FUNG.L 0      0     0     0      0     
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -2.04399017 -0.33265713  0.07191314  0.49972251  1.20545632 
## 
## Number of Observations: 24
## Number of Groups: 
##          BLK TRT %in% BLK 
##            4           12</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="co"># type 3 tests of fixed effects</span></a>
<a class="sourceLine" id="cb123-2" title="2"><span class="kw">anova</span>(mm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             numDF denDF   F-value p-value
## (Intercept)     1     9 1352.1720  &lt;.0001
## TRT             2     6   12.1389  0.0078
## FUNG            1     9   93.6757  &lt;.0001
## TRT:FUNG        2     9   11.8247  0.0030</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="co"># visualize interaction</span></a>
<a class="sourceLine" id="cb125-2" title="2"><span class="kw">emmip</span>(mm_<span class="dv">2</span>, TRT <span class="op">~</span><span class="st"> </span>FUNG)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/mixed-model-yield-1.png" width="672" /></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1"><span class="co"># to do anova for random effects, we need to compare mm_1 with a model that only has fixed effects,</span></a>
<a class="sourceLine" id="cb126-2" title="2"><span class="co"># we can use `gls()` function in `nlme` to fit the fixed effects model</span></a>
<a class="sourceLine" id="cb126-3" title="3">fixed_model_YIELD &lt;-<span class="st"> </span><span class="kw">gls</span>(YIELD <span class="op">~</span><span class="st"> </span>TRT <span class="op">*</span><span class="st"> </span>FUNG,</a>
<a class="sourceLine" id="cb126-4" title="4">                                     <span class="dt">data =</span> a)</a>
<a class="sourceLine" id="cb126-5" title="5"></a>
<a class="sourceLine" id="cb126-6" title="6"><span class="co"># test the random effects in the model</span></a>
<a class="sourceLine" id="cb126-7" title="7"><span class="kw">anova</span>(mm_<span class="dv">2</span>, fixed_model_YIELD)</a></code></pre></div>
<pre><code>##                   Model df      AIC      BIC    logLik   Test   L.Ratio
## mm_2                  1  9 209.9214 217.9348 -95.96070                 
## fixed_model_YIELD     2  7 206.3763 212.6089 -96.18815 1 vs 2 0.4548877
##                   p-value
## mm_2                     
## fixed_model_YIELD  0.7966</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="co"># least square means</span></a>
<a class="sourceLine" id="cb128-2" title="2"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">2</span>, <span class="st">&quot;TRT&quot;</span>))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  TRT emmean   SE df t.ratio p.value
##  1      342 13.3  3 25.716  0.0001 
##  2      291 13.3  3 21.829  0.0002 
##  3      372 13.3  3 27.978  0.0001 
## 
## Results are averaged over the levels of: FUNG 
## d.f. method: containment</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">2</span>, <span class="st">&quot;FUNG&quot;</span>))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  FUNG emmean   SE df t.ratio p.value
##  0       269 11.4  3 23.556  0.0002 
##  1       402 11.4  3 35.198  0.0001 
## 
## Results are averaged over the levels of: TRT 
## d.f. method: containment</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co"># pairwise difference</span></a>
<a class="sourceLine" id="cb134-2" title="2"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">2</span>, pairwise <span class="op">~</span><span class="st"> </span>TRT), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>## $emmeans
##  TRT emmean   SE df t.ratio p.value
##  1      342 13.3  3 25.716  0.0001 
##  2      291 13.3  3 21.829  0.0002 
##  3      372 13.3  3 27.978  0.0001 
## 
## Results are averaged over the levels of: FUNG 
## d.f. method: containment 
## 
## $contrasts
##  contrast estimate   SE df t.ratio p.value
##  1 - 2        51.8 16.8  6  3.079  0.0217 
##  1 - 3       -30.1 16.8  6 -1.792  0.1233 
##  2 - 3       -81.9 16.8  6 -4.871  0.0028 
## 
## Results are averaged over the levels of: FUNG</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">2</span>, pairwise <span class="op">~</span><span class="st"> </span>FUNG))</a></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>## $emmeans
##  FUNG emmean   SE df t.ratio p.value
##  0       269 11.4  3 23.556  0.0002 
##  1       402 11.4  3 35.198  0.0001 
## 
## Results are averaged over the levels of: TRT 
## d.f. method: containment 
## 
## $contrasts
##  contrast estimate   SE df t.ratio p.value
##  0 - 1        -133 13.7  9 -9.679  &lt;.0001 
## 
## Results are averaged over the levels of: TRT</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">2</span>, pairwise <span class="op">~</span><span class="st"> </span>TRT<span class="op">*</span>FUNG), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## $emmeans
##  TRT FUNG emmean   SE df t.ratio p.value
##  1   0       282 17.8  3 15.787  0.0006 
##  2   0       181 17.8  3 10.128  0.0021 
##  3   0       344 17.8  3 19.261  0.0003 
##  1   1       403 17.8  3 22.580  0.0002 
##  2   1       400 17.8  3 22.440  0.0002 
##  3   1       401 17.8  3 22.482  0.0002 
## 
## d.f. method: containment 
## 
## $contrasts
##  contrast  estimate   SE df t.ratio p.value
##  1,0 - 2,0   101.00 23.8  6  4.249  0.0054 
##  1,0 - 3,0   -62.00 23.8  6 -2.608  0.0402 
##  1,0 - 1,1  -121.25 23.8  9 -5.101  0.0006 
##  1,0 - 2,1  -118.75 23.8  6 -4.996  0.0025 
##  1,0 - 3,1  -119.50 23.8  6 -5.027  0.0024 
##  2,0 - 3,0  -163.00 23.8  6 -6.857  0.0005 
##  2,0 - 1,1  -222.25 23.8  6 -9.349  0.0001 
##  2,0 - 2,1  -219.75 23.8  9 -9.244  &lt;.0001 
##  2,0 - 3,1  -220.50 23.8  6 -9.276  0.0001 
##  3,0 - 1,1   -59.25 23.8  6 -2.492  0.0470 
##  3,0 - 2,1   -56.75 23.8  6 -2.387  0.0542 
##  3,0 - 3,1   -57.50 23.8  9 -2.419  0.0387 
##  1,1 - 2,1     2.50 23.8  6  0.105  0.9197 
##  1,1 - 3,1     1.75 23.8  6  0.074  0.9437 
##  2,1 - 3,1    -0.75 23.8  6 -0.032  0.9759</code></pre>
<div id="diagnostic-plots-2" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Diagnostic plots</h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="co"># pearson residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">2</span>, <span class="kw">resid</span>(., <span class="dt">type=</span><span class="st">&quot;pearson&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-yield-1.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="co"># standardaized residuals vs. fitted values</span></a>
<a class="sourceLine" id="cb143-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">2</span>, <span class="kw">resid</span>(., <span class="dt">scaled=</span><span class="ot">TRUE</span>) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-yield-2.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="co"># qq plot</span></a>
<a class="sourceLine" id="cb144-2" title="2"><span class="kw">qqnorm</span>(<span class="kw">residuals</span>(mm_<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb144-3" title="3"><span class="kw">qqline</span>(<span class="kw">residuals</span>(mm_<span class="dv">2</span>))</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-yield-3.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1"><span class="co">#observed vs. fitted values</span></a>
<a class="sourceLine" id="cb145-2" title="2"><span class="kw">plot</span>(mm_<span class="dv">2</span>, YIELD <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(.), <span class="dt">abline =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p><img src="04-ex_yield_loss_files/figure-html/diagnostic-plots-yield-4.png" width="672" /></p>
</div>
</div>
<div id="linear-regression-between-yield-and-ds" class="section level2">
<h2><span class="header-section-number">4.5</span> Linear regression between YIELD and DS</h2>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="co"># fit `lm` model</span></a>
<a class="sourceLine" id="cb146-2" title="2">lm_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(YIELD <span class="op">~</span><span class="st"> </span>DS, <span class="dt">data =</span> a) </a>
<a class="sourceLine" id="cb146-3" title="3"><span class="kw">summary</span>(lm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = YIELD ~ DS, data = a)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -61.196 -18.565   0.856  22.676  56.812 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 399.2384     8.0711   49.47  &lt; 2e-16 ***
## DS           -3.0940     0.2399  -12.90 9.81e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 31.17 on 22 degrees of freedom
## Multiple R-squared:  0.8832, Adjusted R-squared:  0.8779 
## F-statistic: 166.4 on 1 and 22 DF,  p-value: 9.809e-12</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="kw">anova</span>(lm_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: YIELD
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## DS         1 161600  161600  166.38 9.809e-12 ***
## Residuals 22  21368     971                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="co"># diagnostic plots  </span></a>
<a class="sourceLine" id="cb150-2" title="2"><span class="kw">residplot</span>(lm_<span class="dv">1</span>)</a></code></pre></div>
<div id="linear-regression-between-ry1-and-ds" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Linear regression between RY1 and DS</h3>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1">b &lt;-<span class="st"> </span>a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb151-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">RY1 =</span> YIELD<span class="op">/</span><span class="fl">399.23843</span>)</a>
<a class="sourceLine" id="cb151-3" title="3"></a>
<a class="sourceLine" id="cb151-4" title="4"><span class="co"># fit linear regression model</span></a>
<a class="sourceLine" id="cb151-5" title="5">lm_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(RY1 <span class="op">~</span><span class="st"> </span>DS, <span class="dt">data =</span> b)</a>
<a class="sourceLine" id="cb151-6" title="6"><span class="kw">summary</span>(lm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = RY1 ~ DS, data = b)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.153282 -0.046502  0.002143  0.056798  0.142301 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.0000000  0.0202162   49.47  &lt; 2e-16 ***
## DS          -0.0077498  0.0006008  -12.90 9.81e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.07806 on 22 degrees of freedom
## Multiple R-squared:  0.8832, Adjusted R-squared:  0.8779 
## F-statistic: 166.4 on 1 and 22 DF,  p-value: 9.809e-12</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" title="1"><span class="kw">anova</span>(lm_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: RY1
##           Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## DS         1 1.01385 1.01385  166.38 9.809e-12 ***
## Residuals 22 0.13406 0.00609                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" title="1"><span class="co"># diagnostic plots  </span></a>
<a class="sourceLine" id="cb155-2" title="2"><span class="kw">residplot</span>(lm_<span class="dv">2</span>)</a></code></pre></div>
</div>
<div id="transform-dataset-a" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Transform dataset a</h3>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1">a_yield &lt;-<span class="st"> </span>a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-2" title="2"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(BLK, TRT, YIELD) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-3" title="3"><span class="st">    </span><span class="kw">arrange</span>(BLK, TRT, YIELD) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-4" title="4"><span class="st">    </span><span class="kw">group_by</span>(BLK, TRT) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-5" title="5"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">RY2 =</span> YIELD[<span class="dv">1</span>]<span class="op">/</span>YIELD[<span class="dv">2</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-6" title="6"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb156-7" title="7"></a>
<a class="sourceLine" id="cb156-8" title="8"></a>
<a class="sourceLine" id="cb156-9" title="9">a_ds &lt;-<span class="st"> </span>a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-10" title="10"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(BLK, TRT, DS) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-11" title="11"><span class="st">    </span><span class="kw">arrange</span>(BLK, TRT, DS) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-12" title="12"><span class="st">    </span><span class="kw">group_by</span>(BLK, TRT) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-13" title="13"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">CDS =</span> DS[<span class="dv">2</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-14" title="14"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb156-15" title="15"></a>
<a class="sourceLine" id="cb156-16" title="16">a_new &lt;-<span class="st"> </span>a_yield <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-17" title="17"><span class="st">    </span><span class="kw">inner_join</span>(a_ds) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-18" title="18"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-19" title="19"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BLK =</span> <span class="kw">parse_factor</span>(<span class="kw">as.character</span>(BLK)),</a>
<a class="sourceLine" id="cb156-20" title="20">                 <span class="dt">TRT =</span> <span class="kw">parse_factor</span>(<span class="kw">as.character</span>(TRT)))</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;BLK&quot;, &quot;TRT&quot;)</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1"><span class="co"># print the data</span></a>
<a class="sourceLine" id="cb158-2" title="2">a_new</a></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    BLK   TRT     RY2   CDS
##    &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1     1     0.514    43
##  2 1     2     0.239    92
##  3 1     3     0.922     7
##  4 2     1     0.88     27
##  5 2     2     0.544    75
##  6 2     3     0.828    10
##  7 3     1     0.721    47
##  8 3     2     0.565    63
##  9 3     3     0.866    12
## 10 4     1     0.691    32
## 11 4     2     0.472    53
## 12 4     3     0.815    12</code></pre>
</div>
</div>
<div id="mixed-model-for-ry2" class="section level2">
<h2><span class="header-section-number">4.6</span> Mixed model for RY2</h2>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="co"># fit the model  </span></a>
<a class="sourceLine" id="cb160-2" title="2">mm_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lme</span>(RY2 <span class="op">~</span><span class="st"> </span>TRT, <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb160-3" title="3">            <span class="dt">data =</span> a_new,</a>
<a class="sourceLine" id="cb160-4" title="4">            <span class="dt">random =</span> <span class="op">~</span><span class="dv">1</span><span class="op">|</span>BLK) <span class="co"># read mm_3 as mixed model 3</span></a>
<a class="sourceLine" id="cb160-5" title="5"></a>
<a class="sourceLine" id="cb160-6" title="6"><span class="co"># summary output</span></a>
<a class="sourceLine" id="cb160-7" title="7"><span class="kw">summary</span>(mm_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: a_new 
##       AIC      BIC   logLik
##   2.04077 3.026893 3.979615
## 
## Random effects:
##  Formula: ~1 | BLK
##         (Intercept)  Residual
## StdDev:  0.05297273 0.1134963
## 
## Fixed effects: RY2 ~ TRT 
##                  Value  Std.Error DF   t-value p-value
## (Intercept)  0.7016501 0.06262490  6 11.204012  0.0000
## TRT2        -0.2467228 0.08025398  6 -3.074274  0.0218
## TRT3         0.1561339 0.08025398  6  1.945497  0.0997
##  Correlation: 
##      (Intr) TRT2  
## TRT2 -0.641       
## TRT3 -0.641  0.500
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -1.50508335 -0.38516867 -0.01698779  0.58195830  1.29565814 
## 
## Number of Observations: 12
## Number of Groups: 4</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="co"># type 3 tests of fixed effects</span></a>
<a class="sourceLine" id="cb162-2" title="2"><span class="kw">anova</span>(mm_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##             numDF denDF   F-value p-value
## (Intercept)     1     6 254.00333  &lt;.0001
## TRT             2     6  12.81141  0.0068</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1"><span class="co"># to do anova for random effects, we need to compare mm_1 with a model that only has fixed effects,</span></a>
<a class="sourceLine" id="cb164-2" title="2"><span class="co"># we can use `gls()` function in `nlme` to fit the fixed effects model</span></a>
<a class="sourceLine" id="cb164-3" title="3">fixed_model_RY2 &lt;-<span class="st"> </span><span class="kw">gls</span>(RY2 <span class="op">~</span><span class="st"> </span>TRT,</a>
<a class="sourceLine" id="cb164-4" title="4">                                     <span class="dt">data =</span> a_new)</a>
<a class="sourceLine" id="cb164-5" title="5"></a>
<a class="sourceLine" id="cb164-6" title="6"><span class="co"># test the random effects in the model</span></a>
<a class="sourceLine" id="cb164-7" title="7"><span class="kw">anova</span>(mm_<span class="dv">3</span>, fixed_model_RY2)</a></code></pre></div>
<pre><code>##                 Model df       AIC      BIC   logLik   Test   L.Ratio
## mm_3                1  5 2.0407705 3.026893 3.979615                 
## fixed_model_RY2     2  4 0.3057644 1.094663 3.847118 1 vs 2 0.2649939
##                 p-value
## mm_3                   
## fixed_model_RY2  0.6067</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1"><span class="co"># pairwise difference</span></a>
<a class="sourceLine" id="cb166-2" title="2"><span class="kw">test</span>(<span class="kw">emmeans</span>(mm_<span class="dv">3</span>, pairwise <span class="op">~</span><span class="st"> </span>TRT), <span class="dt">adjust =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## $emmeans
##  TRT emmean     SE df t.ratio p.value
##  1    0.702 0.0626  3 11.204  0.0015 
##  2    0.455 0.0626  3  7.264  0.0054 
##  3    0.858 0.0626  3 13.697  0.0008 
## 
## d.f. method: containment 
## 
## $contrasts
##  contrast estimate     SE df t.ratio p.value
##  1 - 2       0.247 0.0803  6  3.074  0.0218 
##  1 - 3      -0.156 0.0803  6 -1.945  0.0997 
##  2 - 3      -0.403 0.0803  6 -5.020  0.0024</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1"><span class="co"># diagnostic plots  </span></a>
<a class="sourceLine" id="cb168-2" title="2"><span class="kw">residplot</span>(mm_<span class="dv">3</span>)</a></code></pre></div>
</div>
<div id="linear-regression-between-ry2-and-cds" class="section level2">
<h2><span class="header-section-number">4.7</span> Linear regression between RY2 and CDS</h2>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1"><span class="co"># fit linear regression model</span></a>
<a class="sourceLine" id="cb169-2" title="2">lm_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(RY2 <span class="op">~</span><span class="st"> </span>CDS, <span class="dt">data =</span> a_new)</a>
<a class="sourceLine" id="cb169-3" title="3"><span class="kw">summary</span>(lm_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = RY2 ~ CDS, data = a_new)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.13338 -0.05085 -0.01090  0.06530  0.12439 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.9386111  0.0467991  20.056 2.09e-09 ***
## CDS         -0.0067778  0.0009845  -6.884 4.28e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.09061 on 10 degrees of freedom
## Multiple R-squared:  0.8258, Adjusted R-squared:  0.8083 
## F-statistic: 47.39 on 1 and 10 DF,  p-value: 4.275e-05</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1"><span class="kw">anova</span>(lm_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: RY2
##           Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## CDS        1 0.38914 0.38914  47.394 4.275e-05 ***
## Residuals 10 0.08211 0.00821                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1"><span class="co"># diagnostic plots  </span></a>
<a class="sourceLine" id="cb173-2" title="2"><span class="kw">residplot</span>(lm_<span class="dv">3</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ex9-5.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-ex_yield_loss.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_epidem_exercises.pdf", "_epidem_exercises.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
